<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Codex Chat</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        body { margin:0; font-family: Arial, sans-serif; display:flex; height:100vh; }
        #sidebar { width:250px; background:#202123; color:#fff; overflow-y:auto; padding:10px; box-sizing:border-box; }
        #sidebar h2 { font-size:1.2em; margin-top:0; }
        #projects { list-style:none; padding:0; }
        #projects li { padding:5px 10px; cursor:pointer; }
        #projects li.active { background:#444654; }
        #main { flex:1; display:flex; flex-direction:column; background:#343541; color:#fff; }
        #messages { flex:1; overflow-y:auto; padding:20px; }
        .message { margin-bottom:10px; }
        .user { text-align:right; }
        .assistant { text-align:left; color:#00b500; }
        #input-area { display:flex; padding:10px; background:#40414f; }
        #input-area textarea { flex:1; resize:none; padding:10px; border:none; border-radius:5px; }
        #input-area button { margin-left:10px; padding:10px 15px; }
    </style>
</head>
<body>
<div id="app">
    <div id="sidebar">
        <h2>Projects</h2>
        <ul id="projects">
            <li v-for="p in projects" :key="p" :class="{active:p===activeProject}" @click="switchProject(p)">{{p}}</li>
        </ul>
        <input v-model="newProject" placeholder="New project" @keyup.enter="addProject">
        <button @click="addProject">Add</button>
    </div>
    <div id="main">
        <div id="messages">
            <div v-for="m in messages" :class="['message', m.role]" :key="m.id">
                <strong>{{m.role === 'user' ? 'You' : 'Assistant'}}:</strong>
                <span>{{m.content}}</span>
            </div>
        </div>
        <div id="input-area">
            <textarea v-model="prompt" rows="2"></textarea>
            <button @click="send" :disabled="loading">Send</button>
        </div>
    </div>
</div>
<script>
    const { createApp } = Vue;
    createApp({
        data() {
            return {
                projects: [],
                activeProject: '',
                newProject: '',
                messages: [],
                prompt: '',
                loading: false
            }
        },
        mounted() {
            this.loadProjects();
        },
        methods: {
            async loadProjects() {
                const res = await fetch('/api/projects');
                const data = await res.json();
                this.projects = data.projects;
                this.activeProject = data.active || '';
            },
            async addProject() {
                if(!this.newProject) return;
                await fetch('/api/projects', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name:this.newProject})});
                this.newProject='';
                this.loadProjects();
            },
            async switchProject(name) {
                await fetch('/api/projects/switch', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name})});
                this.activeProject = name;
                this.messages = [];
            },
            async send() {
                if(!this.prompt) return;
                this.messages.push({id:Date.now(), role:'user', content:this.prompt});
                const currentPrompt = this.prompt;
                this.prompt='';
                this.loading = true;
                const res = await fetch('/api/chat', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({prompt:currentPrompt})});
                const data = await res.json();
                this.messages.push({id:Date.now()+1, role:'assistant', content:data.response});
                this.loading=false;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
